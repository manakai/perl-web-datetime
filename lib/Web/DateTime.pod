=head1 NAME

Web::DateTime - Date and time for Web

=head1 SYNOPSIS

  use Web::DateTime;
  $dt = Web::DateTime->new->parse_global_date_and_time_string ($value);
  warn $dt->to_unix_integer;

=head1 DESCRIPTION

The C<Web::DateTime> module has parsers and serializers of various
date and time representations used in Web.

=head1 METHODS

Following methods are available:

=head2 Instantiation methods

=over 4

=item $dt = Web::DateTime->new

Create a new instance of object with an undefined time value and no
associated time zone value.

=item $dt->onerror ($code)

=item $code = $dt->onerror

Get or set the error handler for parser methods.  Any parse error, as
well as warning and additional processing information, is reported to
the handler.  See
<https://github.com/manakai/data-errors/blob/master/doc/onerror.txt>
for details of error handling.

The value should not be set while the parser is running.  If the value
is changed, the result is undefined.

=back

=head2 Parsing methods

=over 4

=item $dt->parse_date_string ($string)

Parse the specified argument as an HTML date string [HTML].  Set the
result to the object.  If the argument is not a date string, errors
are reported through the C<onerror> handler.

This method is suitable for values from HTML C<< <input type=date> >>.

=item $dt->parse_date_string_with_optional_time ($string)

Parse the specified argument as an HTML date string with optional time
[HTML].  Set the result to the object.  If the argument is not a date
string with optional time, errors are reported through the C<onerror>
handler.

This method is suitable for values in HTML C<< <ins datetime=""> >>
and C<< <del datetime="" >> attributes.

=item $dt->parse_global_date_and_time_string ($string)

Parse the specified argument as an HTML global date and time string
[HTML].  Set the result to the object.  If the argument is not a
global date and time string, errors are reported through the
C<onerror> handler.

This method is suitable for values from HTML C<< <input type=datetime>
>>.

=item $dt->parse_local_date_and_time_string ($string)

Parse the specified argument as an HTML local date and time string
[HTML].  Set the result to the object.  If the argument is not a local
date and time string, errors are reported through the C<onerror>
handler.

This method is suitable for values from HTML C<< <input
type=datetime-local> >>.

=item $dt->parse_month_string ($string)

Parse the specified argument as an HTML month string [HTML].  Set the
result to the object.  If the argument is not a month string, errors
are reported through the C<onerror> handler.

This method is suitable for values from HTML C<< <input type=month>
>>.

=item $dt->parse_time_string ($string)

Parse the specified argument as an HTML time string [HTML].  Set the
result to the object.  If the argument is not a time string, errors
are reported through the C<onerror> handler.

This method is suitable for values from HTML C<< <input type=time> >>.

=item $dt->parse_week_string ($string)

Parse the specified argument as an HTML week string [HTML].  Set the
result to the object.  If the argument is not a week string, errors
are reported through the C<onerror> handler.

This method is suitable for values from HTML C<< <input type=week> >>.

=back

=head2 Serialization methods

=over 4

=item $string = $dt->to_date_string

Serialize the date value represented by the object as an HTML valid
date string [HTML].  Note that time and time zone are ignored.

This method is suitable for values for HTML C<< <input type=date> >>,
C<time> elements, and C<< <ins datetime=""> >> and C<< <del
datetime=""> >> attributes.

=item $string = $dt->to_date_string_with_optional_time

Serialize the date value represented by the object as HTML valid date
string with optional time [HTML].  If the object represents a date,
time, and time zone, it is serialized as a global date and time
string.  Otherwise, it is serialized as a date string.

This method is suitable for values for HTML C<< <ins datetime=""> >>
and C<< <del datetime=""> >> attributes.

=item $string = $dt->to_global_date_and_time_string

Serialize the date value represented by the object as an HTML valid
global date and time string [HTML].

The serialized value always uses the UTC time zone.  The time zone of
the object is ignored (it does affect the value but the time zone
itself does not appear in the serialization).  If the object is not
associated with any time zone, it is interpreted as UTC timestamp
(which could be wrong, however).

Use C<to_time_zoned_global_date_and_time_string> method to preserve
time zone.

The value might not be a normalized date and time string.  It is, in
most cases, also a valid XML Schema C<xs:dateTime> and
C<xs:dateTimeStamp> value and a valid RFC 3339 C<date-time> value.

This method is suitable for values for HTML C<< <input type=datetime>
>>, C<time> elements, and C<< <ins datetime=""> >> and C<< <del
datetime=""> >> attributes.

=item $string = $dt->to_local_date_and_time_string

Serialize the date value represented by the object as an HTML valid
local date and time string [HTML].  Note that time zone is ignored.

The value might not be a normalized local date and time string.  It
is, in most cases, also a valid XML Schema C<xs:dateTime> value.

This method is suitable for values for HTML C<< <input
type=datetime-local> >> and C<time> elements.

=item $string = $dt->to_month_string

Serialize the month value represented by the object as an HTML valid
month string [HTML].  Note that day, time, and time zone are ignored.

This method is suitable for values for HTML C<< <input type=month> >>
and C<time> elements.

=item $string = $dt->to_time_string

Serialize the time value represented by the object as an HTML valid
time string [HTML].  Note that date and time zone are ignored.

This method is suitable for values for HTML C<< <input type=time> >>
and C<time> elements.

=item $string = $dt->to_time_zoned_global_date_and_time_string

Serialize the date value represented by the object as an HTML valid
global date and time string [HTML].

If a time zone is associated with the object, it is used to serialize
the time value.  If the object is not associated with any time zone,
it is interpreted as UTC timestamp (which could be wrong, however).

Use C<to_date_and_time_string> method to always obtain a UTC
timestamp.

This method is suitable for values for HTML C<< <input type=datetime>
>>, C<time> elements, and C<< <ins datetime=""> >> and C<< <del
datetime=""> >> attributes.

=item $string = $dt->to_time_zone_offset_string

Serialize the time zone associated with the object as an HTML valid
time-zone offset string [HTML].  If no time zone is associated with
the object, C<undef> is returned instead.

=item $string = $dt->to_week_string

Serialize the week value represented by the object as an HTML valid
week string [HTML].  Note that month, day, time, and time zone are
ignored.

This method is suitable for values for HTML C<< <input type=week> >>
and C<time> elements.

=back

=head2 Cast methods

=over 4

=item $datetime = $dt->to_datetime

Return a new L<DateTime> object which represents the time represented
by the object.  If the object has associated time zone, the returned
object is in the equivalent time zone.  Otherwise, the returned object
is in the C<floating> time zone.  Note that Web date and time formats
do not support leap seconds while L<DateTime> does support them such
that operations on Web date and time values and L<DateTime> objects
might obtain different results.

This method requires the L<DateTime> module.

=item $number = $dt->to_unix_integer

Return a Unix time value (C<time_t> integer) [POSIX.1] of the time
represented by the object.  The value can be positive or negative, and
might not be a 32-bit integer.  Any fraction part of seconds is
discarded.  Note that the Unix C<time_t> value represents the time
without associated time zone information.  If the object has no
associated time zone, it is considered as a UTC timestamp for the
purpose of conversion.

=item $number = $dt->to_html_month_number

Return the number of the month represented by the object, as used for
C<< <input type=month> >> (i.e. number of months from January 1970)
[HTML].

=item $number = $dt->time_zone_offset_as_seconds

Return the number of seconds of the time zone offset associated with
the object.  If no time zone is associated, C<undef> is returned
instead.

=back

=head2 Value accessors

=over 4

=item $boolean = $dt->has_value

Return whether a valid time value is set to the object or not.  When a
new object is created by the C<new> method, or when a parse method
fails, the object's value is unset (i.e. this method returns false).

=item $number = $dt->year

=item $number = $dt->month

=item $number = $dt->day

=item $number = $dt->hour

=item $number = $dt->minute

=item $number = $dt->second

Return the number in the year, month, day, hour, minute, or second
component of the object, respectively.  If a time zone is associated
with the object, the return value is in that time zone.

=item $string = $dt->second_fraction_string

Return the fraction part of the second component of the time
represented by the object, including leading C<.> character (decimal
separator).  If the fraction part is zero (the second component is an
integer), the empty string is returned.

=item $number = $dt->utc_year

=item $number = $dt->utc_month

=item $number = $dt->utc_day

=item $number = $dt->utc_hour

=item $number = $dt->utc_minute

=item $number = $dt->utc_second

Return the number in the year, month, day, hour, minute, or second
component of the object, respectively.  If a time zone is associated
with the object, the return value is converted into UTC.  Otherwise,
no convertion is performed.

=item $number = $dt->utc_week

Return the week number of the UTC date and time represented by the
object.

=item $number = $dt->utc_week_year

Return the week-year number of the UTC date and time represented by
the object.

=back

# XXX day_of_week utc_day_of_week fractional_second
# utc_fractional_second time_zne_offset_hour time_zone_offset_minute
# to_html_number

=head1 DEPENDENCY

The module requires Perl 5.8 or later and the L<Time::Local> module
(which is a core module).

The C<to_datetime> method requires more module.

=head1 SPECIFICATIONS

=over 4

=item HTML

HTML Standard <http://www.whatwg.org/specs/web-apps/current-work/>.

=item POSIX.1

POSIX.1-2008
<http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap04.html#tag_04_15>.

=back

=head1 AUTHOR

Wakaba <wakaba@suikawiki.org>.

=head1 LICENSE

Copyright 2008-2014 Wakaba <wakaba@suikawiki.org>.

This program is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

=cut
